<html>
	<head>
		<title>
			Scale-Perf
		</title>
		
		<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">
		<link rel="stylesheet" type="text/css" href="css/font-awesome.min.css">
		<link rel="stylesheet" type="text/css" href="css/index.css">
		
		<meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no, width=100%" />
	</head>
	
	<body>
		<header class="container">
			<div class="row col-md-10 col-md-offset-1 col-xs-12 col-xs-offset-0">
				<h1>
					<i class="fa fa-instagram"></i>
					INSTA Wingman bookmarklet
				</h1>
				
				<a onclick="javascript:$('#HowToAddToMobile').modal();" class="right">
					<i class="fa fa-mobile"></i>
					Add it to your mobile phone
				</a>
			</div>
		</header>
		
		<div class="masthead">
			<div class="container">
				<!---->
				<div class="logo">
					<i class="fa fa-instagram"></i>
					INSTA WINGMAN
					<span>
						<i class="fa fa-code"></i>
						DEVELOPER BOOKMARKLET
					</span>
				</div>
				<!---->
				
				<div class="row col-md-10 col-xs-12 col-md-offset-1 col-xs-offset-0">
					<div class="promo_text lead">
						The Wingman that brings you followers.
					</div>
				</div>
				
				<div class="row col-md-10 col-md-offset-1 col-xs-12 col-xs-offset-0">
					<div id="DragLink" class="btn-primary btn-primary-inverse masthead_link">
						<a id="DesktopLink" class="js_desktop_code_to_href">
							INSTA Wingman
						</a>
						
						<i class="fa fa-hand-o-up"></i>
						Drag me into your link bar
					</div>
					
					<!--
					<div class="explain">
						After that go to a webpage and click the bookmarklet
						<a>?</a>
					</div>
					<!---->
				</div>
			</div>
		</div>
		
		<div class="container">
			<div class="row col-md-10 col-md-offset-1 col-xs-12 col-xs-offset-0 main">
				<h3>This is how you use it</h3>
				
				<br />
				<div id="carousel-example-generic" class="carousel slide" data-ride="carousel">
					<!-- Indicators -->
					<ol class="carousel-indicators">
						<li data-target="#carousel-example-generic" data-slide-to="0" class="active"></li>
						<li data-target="#carousel-example-generic" data-slide-to="1"></li>
						<li data-target="#carousel-example-generic" data-slide-to="2"></li>
						<li data-target="#carousel-example-generic" data-slide-to="3"></li>
					</ol>

					<!-- Wrapper for slides -->
					<div class="carousel-inner" role="listbox">
						<div class="item active">
							<img src="images/howToUse_1.jpg" class="img-responsive" />
							<div class="carousel-caption">
								Go somewhere
							</div>
						</div>
						<div class="item">
							<img src="images/howToUse_2.jpg" class="img-responsive" />
							<div class="carousel-caption">
								Click the bookmarklet
							</div>
						</div>
						<div class="item">
							<img src="images/howToUse_3.jpg" class="img-responsive" />
							<div class="carousel-caption">
								<i class="fa fa-star"></i> The performance bar appears <i class="fa fa-star"></i>
							</div>
						</div>
						<div class="item">
							<img src="images/howToUse_4.jpg" class="img-responsive" />
							<div class="carousel-caption">
								To get realistic results, clear cache before use.
							</div>
						</div>
					</div>

					<!-- Controls -->
					<a class="left carousel-control" href="#carousel-example-generic" role="button" data-slide="prev">
						<i class="glyphicon-chevron-left fa fa-chevron-left" aria-hidden="true"></i>
						<span class="sr-only">Previous</span>
					</a>
					<a class="right carousel-control" href="#carousel-example-generic" role="button" data-slide="next">
						<i class="glyphicon-chevron-right fa fa-chevron-right" aria-hidden="true"></i> 
						<span class="sr-only">Next</span>
					</a>
				</div>
				
				<br />
				
				<h3>This is open source. It's hosted, documented and maintained on GitHub.</h3>
				
				<br />
				<br />
				
				<a href="https://github.com/SCALE-Team/scale-perf/" class="btn-primary">
					<i class="fa fa-github"></i> View on GitHub
				</a>
			</div>
		</div>
		
		<div class="page_separator"></div>
		
		<footer class="container">
			<div class="row col-md-10 col-md-offset-1 col-xs-12 col-xs-offset-0">
				<span class="pull-right">
					go to <a href="?developer">developer mode</a> | by Thomas Heigl
				</span>
			</div>
		</footer>
		
		<div id="HowToAddModal" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">No Bro, you didn't click me! Did you?</h4>
					</div>
					<div class="modal-body">
						<p>You have to drag the button and drop it into your link bar!</p>
						
						<img class="img-responsive" src="images/explain.jpg" />
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Ok, got it!</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
		
		<div id="HowToAddToMobile" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">How to add it to your smartphone</h4>
					</div>
					<div class="modal-body">
						<h5>
							Follow these instructions
						</h5>
						
						<ol id="MobileInstruction" class="s1">
							<li class="s1">1. Click this link: <a id="MobileLink" onclick="changeToStep(2)">SCALE Perf bookmarklet</a></li>
							<li class="s2">
								2. Bookmark this page<br />
								<button class="btn" onclick="changeToStep(3)">ok, did it!</button>
							</li>
							<li class="s3">3.
								Edit the bookmark URL and remove everything up to and including the hash ("#")
								so that the bookmark URL starts with "javascript:"
								<br />
								Example:
								<br />
								<img class="img-responsive" src="images/mobileAddBokkmarkletExample.png" />
							</li>
						</ol>
						
						<h5>
							Or create a new bookmark with following URL
						</h5>
						
						<input class="form-control js_desktop_code_to_value" />
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Alright!</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
		
		<div id="HowToUseModal" class="modal fade">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
						<h4 class="modal-title">You didn't understand? Ok let me explain.</h4>
					</div>
					<div class="modal-body">
						<p>You go to a random webpage. Click at the bookmarklet. And that's it..</p>
						
						<img class="img-responsive" src="images/howToUse.jpg" />
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary" data-dismiss="modal">Ahh, I understand!</button>
					</div>
				</div><!-- /.modal-content -->
			</div><!-- /.modal-dialog -->
		</div><!-- /.modal -->
		
		<script src="js/jquery.min.js" type="text/javascript"></script>
		<script src="js/bootstrap.min.js" type="text/javascript"></script>
		
		<script>
			(function(){
				function setJsLinks(content) {
					content = content.replace(new RegExp("\n", 'g'), "");
					content = content.replace(new RegExp("\t", 'g'), "");
					
					var linkElems = document.querySelectorAll(".js_desktop_code_to_href");
					for(var f in linkElems)
					{
						linkElems[f].href = content;
					}
					
					linkElems = document.querySelectorAll(".js_desktop_code_to_value");
					for(var f in linkElems)
					{
						linkElems[f].value = content;
					}
					
					document.querySelector("#MobileLink").href = "#" + content;
				};
				
				function scriptLoadFunction(scriptPath){
					var isLocal = ((self.location+"").split("http://").pop().split("/")[0] == "localhost:8080");
					
					if(scriptPath == null)
					{
						scriptPath = (isLocal ?
							"bookmarklet.js"
							: "https://scale-team.github.io/scale-perf/bookmarklet.js");
					}
					
					var body = document.getElementsByTagName("body")[0];
					
					var loadingElem = document.createElement("div");
					loadingElem.id = "ScalePerfLoadingHint";
					loadingElem.innerHTML = "loading bookmarklet...";
					loadingElem.style.cssText = "color:#fff;position:absolute;top:0;left:0;background-color:#000;padding:5;box-shadow:0 0 5px #000;";
					
					var jselem = document.createElement("script");
					jselem.type = "text/javascript";
					jselem.src = scriptPath;
					jselem.onload = function() {
						body.removeChild(loadingElem);
					};
					
					body.appendChild(loadingElem).appendChild(jselem);
				};
				
				// TEMPORARY
				function scriptLoadFunction() {
					/* wrapper */
					$("._n3cp9");
					/* list */
					$("._4j13h");
					
					var scrollContainer = $("._4gt3b");
					
					var followUsers = function() {
						$("._csba8[data-reactid]").slice(0, 20).click();
					};
					
					var getUsers = function() {
						return $("._csba8[data-reactid]");
					};
					
					var loadMoreUsers = function() {
						scrollContainer.scrollTop(Math.pow(2,32));
					};
					
					var getMilliseconds = function() {
						return Date.UTC(0,0,0,0,new Date().getMinutes(),new Date().getSeconds());
					};

					/*Scroll down as long as new followers appear or the wanted amount is reached*/
					function loadUsers(usersToLoad, updateCallback, successCallback) {
						var amountOfUsers = 0;
						if(amountOfUsers < usersToLoad)
						{
							var maxWaitingTime = 2000;
							
							var lastSuccessTime = getMilliseconds();
							
							/* Watch */
							var interval = window.setInterval(function(){
								console.log("Check");
								
								var timeSinceLastSuccess = getMilliseconds() - lastSuccessTime;
								
								if(getUsers().length > amountOfUsers) {
									lastSuccessTime = getMilliseconds();
									amountOfUsers = getUsers().length;

									updateCallback(amountOfUsers);
									
									if(amountOfUsers >= usersToLoad) {
										window.clearInterval(interval);
										successCallback(amountOfUsers);
										return;
									}
									
									console.log("Too less users: " + amountOfUsers + ". Try to load more users.");
									loadMoreUsers();
									return;
								}
								
								if(timeSinceLastSuccess > maxWaitingTime) {
									window.clearInterval(interval);
									successCallback(amountOfUsers);
									return;
								}
							}, 50);
						}
					};

					loadUsers(Math.pow(2,32), function(usersLoaded) {
						$("._q44m8 span").remove();
						$("._q44m8").append($("<span>").text(usersLoaded + " users loaded."));
					}, function(usersLoaded) {
						alert("Found users:" + usersLoaded);
					});
				};
				// TEMPORARY
				
				setJsLinks('javascript:' + scriptLoadFunction + '; scriptLoadFunction();');
				
				(function() {
					/*Get GET-parameters*/ {
						var _GET = {};
						var parts = location.href.split("?");
						
						if(parts.length > 1)
						{
							parts = parts.pop();
							parts = parts.split("#")[0];
							parts = parts.split("&");
							
							for(var f in parts)
							{
								var p = parts[f].split("=");
								
								_GET[p[0]] = (p.length > 1 ? p[1] : true);
							}
						}
					}
					
					// If developer set, modify bookmarklet URL
					if(_GET["developer"] != null)
					{
						setJsLinks('javascript:var isDevelopmentMode=true; ' + scriptLoadFunction + '; scriptLoadFunction("https://scale-team.github.io/scale-perf-dev/bookmarklet.js");');
						
						document.querySelector("#DesktopLink").innerHTML += " DEV";
						
						// Show visually, that this is the developer mode
						var logoSub = $(".logo span");
						
						logoSub.css("font-size", 10);
					}
					
					if(_GET["developer"] == null)
					{
						var dragLink = document.querySelector("#DragLink");
						dragLink.onclick = function() {
							var style = document.createElement("style");
							style.innerHTML += "#PerfBar { display: none !important; }";
							document.head.appendChild(style);
							
							$("#HowToAddModal").modal();
						};
					}
				})();
				
				$(".explain").click(function() {
					$("#HowToUseModal").modal();
				});
			})();
			
			function changeToStep(nr){
				document.querySelector("#MobileInstruction").className = "s" + nr;
			}
		</script>
	</body>
</html>